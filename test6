{"lastmodifiedby":"admin","lastmodifieddate":"2025-01-03 08:09:26","alias":"MGFDumpreport","id":981,"name":"MGFMGFDM38521","description":"MGFDumpreport","attributes":{"filter":"","mode":"query","Query":"WITH ClarificationInfo AS (\n    SELECT \n        businesskeyId,\n        CASE WHEN COUNT(*) >= 1 THEN 'Yes' ELSE 'No' END AS ClarificationReceived,\n        COUNT(*) AS ClarificationCount\n    FROM [leapmaster].[dbo].[icm_audit]\n    WHERE comments = 'Case status changed to Clarification Requested'\n    GROUP BY businesskeyId\n),\nTaskDurations AS (\n    SELECT \n        business_key,\n        SUM(COALESCE(CAST(duration AS BIGINT), 0)) / 60000 AS ActualSLA\n    FROM mgftablenew_task_durations\n    WHERE task_name NOT IN ('mailReceived') \n    AND status IN ('ticketClosure', 'noActionRequired')\n    AND duration IS NOT NULL\n    GROUP BY business_key\n),\nStatusMapping AS (\n    SELECT 'discarded' AS status_, 'Discarded' AS StatusName\n    UNION ALL SELECT 'inProgress', 'In Progress'\n    UNION ALL SELECT 'new', 'New'\n\tUNION ALL SELECT 'noActionRequired', 'No Action Required'\n\tUNION ALL SELECT 'ticketClosure', 'Ticket Closure'\n\tUNION ALL SELECT 'clarificationRequested', 'Clarification Requested'\n\tUNION ALL SELECT 'Reopen', 'Re-Open'\n\tUNION ALL SELECT 'sendBackToSme', 'Send Back To SME'\n\tUNION ALL SELECT 'accepted', 'Accepted'\n\tUNION ALL SELECT 'rejected', 'Rejected'\n\tUNION ALL SELECT 'duplicate', 'Duplicate'\n\tUNION ALL SELECT 'clarificationreceived', 'Clarification Received'\n    -- Add other status mappings here\n),\nReasonMapping AS (\n    SELECT 'notInScope' AS reason, 'Not In Scope' AS ReasonName\n    UNION ALL SELECT 'duplicate', 'Duplicate'\n    UNION ALL SELECT 'closedByMerchant', 'Closed by Merchant'\n\tUNION ALL SELECT 'completed', 'Completed'\n\tUNION ALL SELECT 'inProgress', 'In Progress'\n\tUNION ALL SELECT 'notInScope', 'Not In Scope'\n\tUNION ALL SELECT 'additionalInfoRequestedFromTradewin', 'Additional Info requested from Tradewin'\n\tUNION ALL SELECT 'cpoNotFoundInBamboorose', 'CPO not found in Bamboorose'\n\tUNION ALL SELECT 'dataMismatchBetweenDataChartAndBambooRoseCpoVpo', 'Data Mismatch between Data Chart and Bamboo Rose (CPO/VPO)'\n\tUNION ALL SELECT 'furtherConfirmationFromMerchant', 'Further confirmation from Merchant'\n\tUNION ALL SELECT 'invalidInformationOnDataChart', 'Invalid Information on Data chart'\n\tUNION ALL SELECT 'missingInfoIncompleteDataChart', 'Missing info/Incomplete Data chart'\n\tUNION ALL SELECT 'others', 'Others'\n\tUNION ALL SELECT 'raisedRequestWithGsd', 'Raised Request with GSD'\n\tUNION ALL SELECT 'styleNotRevealedFoundInCustomerSystem', 'Style not Revealed/Found in Customer System'\n\tUNION ALL SELECT 'systemIssueApplicationDownUnableToLogin', 'System Issue Application down/Unable to login'\n\tUNION ALL SELECT 'unableToPerformCpoVpoAssignment', 'Unable to Perform CPO/VPO Assignment'\n\tUNION ALL SELECT 'vpoNotApproved', 'VPO Not Approved'\n\tUNION ALL SELECT 'furtherConfirmationFromMgfItTeam', 'Further confirmation from MGF IT team'\n\tUNION ALL SELECT 'notInScopeOfService', 'Not in scope of service'\n\tUNION ALL SELECT 'sendBackToSme', 'Send Back To SME'\n\n\n    -- Add other reason mappings here\n),\nBrandMapping AS (\n    SELECT 'chicos' AS brand, 'Chico''s' AS BrandName\n    UNION ALL SELECT 'soma', 'SOMA'\n    UNION ALL SELECT 'vineyardVines', 'Vineyard Vines'\n\tUNION ALL SELECT'whiteHouseBlackMarket' , 'White House Black Market'\n\t\t\t UNION ALL SELECT'jCrew' , 'J.Crew'\n\t\t\t UNION ALL SELECT'express' , 'Express'\n\t\t\t UNION ALL SELECT'talbots' , 'Talbots'\n\t\t\t UNION ALL SELECT'pink' , 'PINK'\n\t\t\t UNION ALL SELECT'belkPrivateLabel' , 'Belk Private Label'\n\t\t\t UNION ALL SELECT'maurices' , 'Maurices'\n\t\t\t UNION ALL SELECT'torrid' , 'Torrid'\n\t\t\t UNION ALL SELECT'belkLimited' , 'Belk Limited'\n\t\t\t UNION ALL SELECT'stitchFix' , 'Stitch Fix'\n\t\t\t UNION ALL SELECT'victoriasSecret' , 'Victoria s Secret'\n\t\t\t UNION ALL SELECT'laneBryant' , 'Lane Bryant'\n\t\t\t UNION ALL SELECT'annTaylor' , 'Ann Taylor'\n\t\t\t UNION ALL SELECT'loft' , 'LOFT'\n\t\t\t UNION ALL SELECT'footLocker' , 'Foot Locker'\n\t\t\t UNION ALL SELECT'maurice' , 'Maurice s'\n\t\t\t UNION ALL SELECT'allBrands' , 'All Brands'\n--\t\t\t UNION ALL SELECT'softSurroundings' , 'Soft Surroundings'\n--\t\t\t UNION ALL SELECT'brumsMilano' , 'Brums Milano'\n--\t\t\t UNION ALL SELECT'spanx' , 'SPANX'\n--\t\t\t UNION ALL SELECT'gap' , 'GAP'\n--UNION ALL SELECT'cab' , 'CAB'\n--UNION ALL SELECT'whbm' , 'WHBM'\n    -- Add other brand mappings here\n),\nRequestTypeMapping AS (\n    SELECT 'amendVpoFieldLevel' AS request_type, 'Amend VPO Field Level' AS RequestTypeName\n    UNION ALL SELECT 'downloadTechpack', 'Download Techpack'\n    UNION ALL SELECT 'customerPurchaseOrder', 'Customer Purchase Order'\n\tUNION ALL SELECT 'ePattern' , 'E-Pattern'\n\tUNION ALL SELECT 'downloadCad' , 'Download Cad'\n\tUNION ALL SELECT 'colorCommentsDownload' , 'Color Comments Download'\n\tUNION ALL SELECT 'drawDevelopmentChart' , 'Draw Development Chart'\n\tUNION ALL SELECT 'downloadNfg' , 'Download Nfg'\n\tUNION ALL SELECT 'uploadEta' , 'Upload Eta'\n\tUNION ALL SELECT 'strikeOffDownload' , 'Strike Off Download'\n\tUNION ALL SELECT 'updateTnaData' , 'Update TNA Data'\n\tUNION ALL SELECT 'updateCostData' , 'Update Cost Data'\n\tUNION ALL SELECT 'downloadLineSheet' , 'Download Line Sheet'\n\tUNION ALL SELECT 'cpoCreation' , 'Cpo Creation'\n\tUNION ALL SELECT 'updateSampleTracking' , 'Update Sample Tracking'\n\tUNION ALL SELECT 'downloadCancelledCpOs' , 'Download Cancelled CpOs'\n\tUNION ALL SELECT 'amendVpo' , 'Amend VPO'\n\tUNION ALL SELECT 'fsfeReport' , 'FSFE Report'\n\tUNION ALL SELECT 'vpoStatusMonitoringReport' , 'VPO Status Monitoring Report'\n\tUNION ALL SELECT 'miscellanneousReport' , 'Miscellanneous Report'\n\tUNION ALL SELECT 'logisticMonitoringReport' , 'Logistic Monitoring Report'\n\tUNION ALL SELECT 'sampleMeasurementUpload' , 'Sample Measurement Upload'\n\tUNION ALL SELECT 'riskAssessmentUpload' , 'Risk Assessment Upload'\n\tUNION ALL SELECT 'createTechspec' , 'Create Techspec'\n\tUNION ALL SELECT 'revisedTechspec' , 'Revised Techspec'\n\tUNION ALL SELECT 'reviseOfferLine' , 'Revise Offer Line'\n\tUNION ALL SELECT 'vpoCancellation' , 'VPO Cancellation'\n\tUNION ALL SELECT 'vpoMerchListReport' , 'VPO Merch List Report'\n\tUNION ALL SELECT 'sscInternalExceptionReport' , 'SSC Internal Exception Report'\n\tUNION ALL SELECT 'oddShipToExceptionReport' , 'Odd Ship To Exception Report'\n\tUNION ALL SELECT 'rpaVpoCreation' , 'RPA VPO Creation'\n\tUNION ALL SELECT 'createOfferLine' , 'Create Offer Line'\n\tUNION ALL SELECT 'rpaVpoCpoAssignment' , 'RPA VPO CPO Assignment'\n\tUNION ALL SELECT 'poCollaboration' , 'PO Collaboration'\n\tUNION ALL SELECT 'bomUpdate' , 'BOM Update'\n\tUNION ALL SELECT 'amendCpo' , 'Amend Cpo'\n\tUNION ALL SELECT 'createCpo' , 'Create Cpo'\n\tUNION ALL SELECT 'fabricMillDetailsUpdate' , 'Fabric Mill Details Update'\n\tUNION ALL SELECT 'amendmentsIpHtsCodeGeneration' , 'Amendments IP HTS code generation'\n\tUNION ALL SELECT 'vpoApproval' , 'VPO Approval'\n\tUNION ALL SELECT 'vpoCpoAssignment' , 'VPO CPO Assignment'\n\tUNION ALL SELECT 'createVpo' , 'Create Vpo'\n\tUNION ALL SELECT 'scoWeeklyReports' , 'SCO Weekly Reports'\n\tUNION ALL SELECT 'assignmentStatusWithSubmittedPlReport' , 'Assignment Status With Submitted PL Report'\n\tUNION ALL SELECT 'vpoAlphaErrorReport' , 'VPO Alpha Error Report'\n\tUNION ALL SELECT 'vpoListWithInactiveCustomerDepartment' , 'VPO List With Inactive Customer Department'\n    UNION ALL SELECT 'ipCqCompletionHtsCodeGeneration' , 'IP CQ completion - HTS code generation'\n    UNION ALL SELECT 'techpackCreation' , 'Techpack Creation'\t\n --   UNION ALL SELECT 'materialIdCreation' , 'Material ID Creation'\n\t--UNION ALL SELECT 'bomAssignment' , 'BOM Assignment'\n\t--UNION ALL SELECT 'patternDownload' , 'Pattern Download'\n\t--UNION ALL SELECT 'vpoCreation' , 'VPO Creation'\n\t--UNION ALL SELECT 'sampleReportDownload' , 'Sample Report Download'\n\t--UNION ALL SELECT 'invoiceDownload' , 'Invoice Download'\n    -- Add other request type mappings here\n)\n\nSELECT DISTINCT\n    jt.[business_key_] AS CaseId,\n    jt.[proc_def_key_] AS 'Process Name',\n    CASE \n        WHEN jt.[source_] = 'Manual' THEN 'Manual' \n        WHEN jt.[source_] = 'email' THEN 'Email' \n    END AS 'Mode Name',\n    FORMAT(SWITCHOFFSET(jt.created_date_, '+05:30'), 'yyyy-MM-dd') AS 'Created Date',\n    FORMAT(SWITCHOFFSET(jt.created_date_, '+05:30'), 'yyyy-MM-dd HH:mm:ss') AS 'Task Created Date and Time',\n    FORMAT(SWITCHOFFSET(jt.last_updated_date_, '+05:30'), 'yyyy-MM-dd HH:mm:ss') AS 'Last Updated Date',\n    jt.[requested_by] AS 'Task Created By',\n    jt.[current_assignee_] AS 'Current Assignee',\n    jt.[last_assignee_] AS 'Last Assignee',\n    COALESCE(sm.StatusName, jt.[status_]) AS 'Status Name',\n    COALESCE(rm.ReasonName, jt.[reason]) AS 'Reason Code',\n    jt.[comment] AS 'Comment',\n    COALESCE(bm.BrandName, jt.[brand]) AS 'Brand',\n    CASE \n        WHEN jt.[case_priority] = 'high' THEN 'High'\n        WHEN jt.[case_priority] = 'medium' THEN 'Medium'\n        WHEN jt.[case_priority] = 'low' THEN 'Low'\n    END AS 'Case Priority',\n    CASE \n        WHEN jt.[process] = 'customerApps' THEN 'Customer APPS'\n        WHEN jt.[process] = 'bambooRose' THEN 'Bamboo Rose'\n    END AS 'BR or CA',\n    jt.[requested_by] AS 'Requester Email ID',\n    COALESCE(rtm.RequestTypeName, mv.[value]) AS 'Request Type',\n\t(case when mv.[value]='amendVpoFieldLevel' then vol_amend_vpo_fl\n\twhen mv.[value]='downloadTechpack' then vol_down_techpack\n\twhen mv.[value]='customerPurchaseOrder' then vol_cust_po\n\twhen mv.[value]='ePattern' then vol_epattern\n\twhen mv.[value]='downloadCad' then vol_down_cad\n\twhen mv.[value]='colorCommentsDownload' then vol_col_comm_down\n\twhen mv.[value]='drawDevelopmentChart' then vol_draw_dev_chart\n\twhen mv.[value]='downloadNfg' then vol_down_nfg\n\twhen mv.[value]='uploadEta' then vol_upload_eta\n\twhen mv.[value]='strikeOffDownload' then vol_strike_off_down\n\twhen mv.[value]='updateTnaData' then vol_update_tna_d\n\twhen mv.[value]='updateCostData' then vol_update_cost_d\n\twhen mv.[value]='downloadLineSheet' then vol_down_linesheet\n\twhen mv.[value]='cpoCreation' then vol_cpo_crea\n\twhen mv.[value]='updateSampleTracking' then vol_upda_samp_track\n\twhen mv.[value]='downloadCancelledCpOs' then vol_down_cance_cpo\n\twhen mv.[value]='amendVpo' then vol_amend_vpo\n\twhen mv.[value]='fsfeReport' then vol_fsfe_report\n\twhen mv.[value]='vpoStatusMonitoringReport' then vol_vpo_mr\n\twhen mv.[value]='miscellanneousReport' then vol_miscellaneous_re\n\twhen mv.[value]='logisticMonitoringReport' then vol_logistic_mr\n\twhen mv.[value]='sampleMeasurementUpload' then vol_sam_measure_up\n\twhen mv.[value]='riskAssessmentUpload' then vol_risk_ass_uplo\n\twhen mv.[value]='createTechspec' then vol_create_tech\n\twhen mv.[value]='revisedTechspec' then vol_revise_tech\n\twhen mv.[value]='reviseOfferLine' then vol_revise_offer_l\n\twhen mv.[value]='vpoCancellation' then vol_vpo_cance\n\twhen mv.[value]='vpoMerchListReport' then vol_vpo_merch_listr\n\twhen mv.[value]='sscInternalExceptionReport' then vol_ssc_internal_er\n\twhen mv.[value]='oddShipToExceptionReport' then vol_odd_shipto_er\n\twhen mv.[value]='rpaVpoCreation' then vol_rpa_vpo_crea\n\twhen mv.[value]='createOfferLine' then vol_create_off_li\n\twhen mv.[value]='rpaVpoCpoAssignment' then vol_rpa_vpo_cpo_ass\n\twhen mv.[value]='poCollaboration' then vol_po_collab\n\twhen mv.[value]='bomUpdate' then vol_bom_upda\n\twhen mv.[value]='amendCpo' then vol_amend_cpo\n\twhen mv.[value]='createCpo' then vol_create_cpo\n\twhen mv.[value]='fabricMillDetailsUpdate' then vol_fab_mill_details_up\n\twhen mv.[value]='amendmentsIpHtsCodeGeneration' then vol_amend_ip_hts_cg\n\twhen mv.[value]='vpoApproval' then vol_vpo_approval\n\twhen mv.[value]='vpoCpoAssignment' then vol_vpo_cpo_ass\n\twhen mv.[value]='createVpo' then vol_create_vpo\n\twhen mv.[value]='scoWeeklyReports' then vol_sco_weekly_reports\n\twhen mv.[value]='assignmentStatusWithSubmittedPlReport' then vol_assign_status_plr\n\twhen mv.[value]='vpoAlphaErrorReport' then vol_vpo_alpha_er\n\twhen mv.[value]='vpoListWithInactiveCustomerDepartment' then vol_vpo_list_wi_cus_de\n    when mv.[value]='ipCqCompletionHtsCodeGeneration' then vol_ip_cq_comp\n    when mv.[value]='techpackCreation' then vol_techpack_crea\n --   when mv.[value]='materialIdCreation' then vol_mat_id_creation\n --   when mv.[value]='bomAssignment' then vol_bom_ass\n\t--when mv.[value]='patternDownload' then vol_pat_down\n\t--when mv.[value]='vpoCreation' then vol_vpo_creation\n\t--when mv.[value]='sampleReportDownload' then vol_sam_rep_down\n\t--when mv.[value]='invoiceDownload' then vol_inv_down\n       end ) as Volume,\n    -- Add other columns here\n\n\t(Case when [sales_office_location] ='hongKong' then 'Hong Kong'\n        when [sales_office_location] ='chinaShanghai' then 'China (Shanghai)'\n        when [sales_office_location] ='vietnam' then 'Vietnam'\n        when [sales_office_location] ='korea' then 'Korea'\n        when [sales_office_location] ='indonesia' then 'Indonesia'\n       when [sales_office_location] ='bangladesh' then 'Bangladesh'\n       when [sales_office_location] ='sriLanka' then 'Sri Lanka'\n       when [sales_office_location] ='india' then 'India' end)  as 'Sales Office Location'\n      ,[short_description] as 'Subject Line'\n      ,[volume] as 'Total Volume'\n\t  ,FORMAT(SWITCHOFFSET(created_date_, '+05:30'),'yyyy-MM-dd HH:mm:ss') as 'SLA Start Date'\n\t  ,FORMAT(SWITCHOFFSET(due_date_, '+05:30'),'yyyy-MM-dd HH:mm:ss') as 'SLA Due Date'\n\t  ,FORMAT(SWITCHOFFSET(end_date_, '+05:30'),'yyyy-MM-dd HH:mm:ss') as 'Actual End Date'\n\t  ,m.[slatimeinmilliseconds]/60000 as SLA,\n\t  -- Optimized TotalSLA calculation\n(SELECT SUM(CAST(msca.[slatimeinmilliseconds] AS BIGINT)) / 60000\n  FROM [leapmaster_ref_data].[dbo].[MGFSLAConfigurationOnAttributes] AS msca\n  JOIN OPENJSON(jt.[request_type]) AS openj ON openj.[value] = msca.request_type\n  WHERE msca.brand = jt.brand) AS TotalSLA\n\n-- Optimized Total Time calculation\n,CASE \n  WHEN DATEDIFF(MINUTE, created_date_, end_date_) > 0 \n  THEN DATEDIFF(MINUTE, created_date_, end_date_) \n  ELSE NULL \n END AS [Total Time (in Minutes)]\n\n-- Optimized Configured Time calculation\n,dbo.GetDateStringFromMinutes(m.[slatimeinmilliseconds] / 60000, 690) AS [Configured Time]\n\n-- Optimized SLAMet calculation\n,CASE \n  WHEN end_date_ IS NOT NULL THEN\n    CASE \n      WHEN end_date_ <= due_date_ THEN 'YES'\n      ELSE 'No'\n    END\n  ELSE\n    CASE \n      WHEN GETUTCDATE() < due_date_ THEN 'Inprogress'\n      ELSE 'No'\n    END\n END AS 'SLAMet',\n    ci.ClarificationReceived AS 'Clarification Received or not',\n    ci.ClarificationCount AS 'Clarification_Count',\n    CASE \n        WHEN jt.state_ IN ('active', 'waiting') THEN DATEDIFF(MINUTE, GETUTCDATE(), jt.due_date_)\n        ELSE NULL \n    END AS [RemainingTime(Min)],\n    td.ActualSLA AS 'Actual SLA(TimeTakenbyInfosys)',\n    dbo.GetDateStringFromMinutes(td.ActualSLA, 690) AS [Time Taken by Infosys]\nFROM \n    [leapmaster_ref_data].[dbo].[mgftablenew] jt\nCROSS APPLY \n    OPENJSON(jt.[request_type]) AS mv\nJOIN \n    [leapmaster_ref_data].[dbo].[MGFSLAConfigurationOnAttributes] AS m ON (jt.[brand] = m.[brand] AND mv.[value] = m.[request_type])\nLEFT JOIN \n    StatusMapping sm ON jt.status_ = sm.status_\nLEFT JOIN \n    ReasonMapping rm ON jt.reason = rm.reason\nLEFT JOIN \n    BrandMapping bm ON jt.brand = bm.brand\nLEFT JOIN \n    RequestTypeMapping rtm ON mv.[value] = rtm.request_type\nLEFT JOIN \n    ClarificationInfo ci ON jt.business_key_ = ci.businesskeyId\nLEFT JOIN \n    TaskDurations td ON jt.business_key_ = td.business_key\nWHERE \n    jt.proc_def_key_ = 'SSCProcess'\n    AND jt.created_date_ >= DATEADD(DAY, -90, GETUTCDATE())","Cacheable":"","isStreaming":"false","Headers":"","defaultValues":"","QueryParams":"","writeMode":"append","params":"","tableName":"","uniqueIdentifier":"BID"},"type":"r","datasource":{"lastmodifiedby":"admin","lastmodifieddate":"2024-08-22 05:38:32","alias":"MGFLeapReferenceDataSource","id":64,"name":"MGFMGFLP98028","description":"MGFLeapReferenceDataSource","type":"MSSQL","salt":"kYM26XzAhvveNu520EkqSapzpncbIrXb5d8f8oM4sq1uJmRCeeqiGZ1HCljADXTsW8mJ2FqW5iMAfxUJWGYstQ==","connectionDetails":"{}","organization":"MGFLeapBizOps","category":"SQL","extras":"{\"apispec\":{},\"apispectemplate\":{}}"},"backingDataset":null,"organization":"MGFLeapBizOps","expStatus":0,"views":null,"context":null,"archivalConfig":null,"isArchivalEnabled":null,"isApprovalRequired":false,"isPermissionManaged":false,"isAuditRequired":true,"isInboxRequired":true,"dashboard":null,"metadata":null,"modeltype":null,"taskdetails":[],"groups":["MGFMGFGR89347"]}
